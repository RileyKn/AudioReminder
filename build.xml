<name>Node.js with MongoDB CI</name>
<on>
  <push>
    <branches>main</branches>
  </push>
  <pull_request>
    <branches>main</branches>
  </pull_request>
</on>
<jobs>
  <build>
    <runs-on>ubuntu-latest</runs-on>
    <strategy>
      <matrix>
        <node-version>18.x</node-version>
        <node-version>20.x</node-version>
        <node-version>22.x</node-version>
      </matrix>
    </strategy>
    <steps>
      <name>Checkout repository</name>
      <uses>actions/checkout@v4</uses>
    </steps>
    <steps>
      <name>Use Node.js ${{ matrix.node-version }}</name>
      <uses>actions/setup-node@v4</uses>
      <with>
        <node-version>${{ matrix.node-version }}</node-version>
        <cache>npm</cache>
      </with>
    </steps>
    <steps>
      <name>Install MongoDB</name>
      <run>sudo apt-get updatesudo apt-get install -y gnupgwget -qO - https://www.mongodb.org/static/pgp/server-6.0.asc | sudo gpg --dearmor -o /usr/share/keyrings/mongodb-server-keyring.gpgecho "deb [signed-by=/usr/share/keyrings/mongodb-server-keyring.gpg] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/6.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-6.0.listsudo apt-get updatesudo apt-get install -y mongodb-orgsudo systemctl start mongodsudo systemctl enable mongod</run>
    </steps>
    <steps>
      <name>Verify MongoDB Installation</name>
      <run>mongod --version</run>
    </steps>
    <steps>
      <name>Install Node.js dependencies</name>
      <run>npm ci</run>
    </steps>
    <steps>
      <name>Install Mongoose</name>
      <run>npm install mongoose</run>
    </steps>
    <steps>
      <name>Build project (if applicable)</name>
      <run>npm run build --if-present</run>
    </steps>
    <steps>
      <name>Run tests</name>
      <run>npm test</run>
    </steps>
  </build>
</jobs>